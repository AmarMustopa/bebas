{% extends 'monitoring/base.html' %}
{% load static %}

{% block content %}
<div class="status-card">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-semibold">{{ display_name }}</h1>
        <div class="text-sm text-gray-500">Last value: <strong>{{ last_value }} {{ unit }}</strong></div>
    </div>

    <div class="mb-6">
        <div class="text-sm text-gray-500">Status</div>
        <div class="text-2xl font-bold 
            {% if status == 'Normal' %}text-green-600
            {% elif status == 'Warning' %}text-yellow-600
            {% elif status == 'Danger' %}text-red-600
            {% else %}text-gray-600{% endif %}">
            {{ status }}
        </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow mb-6">
        <div class="text-sm text-gray-500 mb-4">Trend (recent readings)</div>
        <div class="chart-container" style="height:240px;">
            <canvas id="sensorDetailChart" height="240" style="max-height:240px; width:100%;"></canvas>
        </div>
    </div>

    <div class="flex justify-end">
        <a href="{% url 'dashboard' %}" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300">Kembali ke Dashboard</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const labels = {{ labels_js|safe }};
const dataValues = {{ values_js|safe }};
const ctx = document.getElementById('sensorDetailChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: '{{ display_name }}',
            data: dataValues,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59,130,246,0.1)',
            tension: 0.2,
            pointRadius: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: { beginAtZero: true }
        }
    }
});
// Ensure Chart.js recalculates sizes after render (fixes oversized canvas issues)
setTimeout(() => {
    try {
        if (ctx && ctx.canvas) {
            ctx.canvas.style.height = '240px';
            window.dispatchEvent(new Event('resize'));
        }
    } catch (e) {
        console.warn('Chart resize workaround failed', e);
    }
}, 50);
</script>
{% endblock %}